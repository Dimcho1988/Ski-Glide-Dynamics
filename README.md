# onFlows — Демонстрация на модел за коефициент на триене

Това е минимално Streamlit приложение, което имплементира модела за
коефициент на триене и модулирана скорост с фиксирана референтна активност.

## Файлове

- `streamlit_app.py` — основно приложение (UI).
- `friction_model.py` — функции за обработка на данните и модела.
- `requirements.txt` — зависимости за инсталиране.

## Стартиране (локално)

```bash
pip install -r requirements.txt
streamlit run streamlit_app.py
```

## Формат на входните данни

Поддържат се два формата:

### 1) TCX

Извличат се:

- `Time` (Trackpoint)
- `AltitudeMeters`
- `DistanceMeters`

Времето се преобразува в секунди от началото, а дистанцията и височината — в метри.

### 2) CSV

Очаквани колони (чувствителни към малки букви само частично):

- време: `time`, `seconds` или `t` (s)
- височина: `elevation`, `altitude`, `alt`, `h` (m)
- дистанция: `distance`, `dist`, `d` (m)

Ако времето е datetime, то се конвертира до секунди от началото.

## Логика в модела

1. Ресемплиране до 1 Hz и изглаждане (5 сек за височина, 3 точки за дистанция).
2. Изчисляване на наклон (slope = Δh/Δd), скорост v и ускорение a.
3. Детекция на сегменти на свободно плъзгане (по наклон и скорост).
4. Оценка на μ_eff по физичния модел и филтрация на нереалистични стойности.
5. Сесийна медиана μ_session за активността.
6. Избор на референтна активност (μ_ref).
7. Friction Index FI = μ_session / μ_ref.
8. Теоретичен коефициент K_raw = μ_ref / μ_session и ограничен K.
9. Модулиране на скоростта: v_mod = v * K.
10. Визуализация на реална и модулирана скорост v и v_mod(t).

Можеш да дупликираш и доразвиеш този код според нуждите на основния onFlows проект.
